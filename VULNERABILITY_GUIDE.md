# Vulnerability Guide: React-to-Shell (CVE-2025-55182)

This guide explains the "React-to-Shell" vulnerability found in Next.js versions 15.0.0-15.0.4.

## 1. What is the Vulnerability?

**CVE-2025-55182** is a **Remote Code Execution (RCE)** vulnerability. This means an attacker can send a special message to your server that allows them to run *any* command they want (like deleting files, stealing data, or installing malware).

It affects:
- **Next.js** (App Router): versions 15.0.0 to 15.0.4
- **React Server Components** (flight protocol): versions 19.0.0 to 19.2.0

## 2. Why Does It Happen?

When Next.js receives a request from the client (your browser), it uses a protocol called **Flight** (React Server Components). This protocol sends data (like variables, components, etc.) back and forth.

The vulnerability is in how the server "unpacks" (deserializes) this data.

1.  **Prototype Pollution**: The server doesn't properly check if the data is modifying the "prototype" of Javascript objects.
2.  **Function Execution**: Attackers can use this to trick the server into treating a piece of data as a "Function".
3.  **Command Injection**: By referencing `child_process.execSync` (a Node.js command tool), the attacker can execute system shell commands.

## 3. The Code Explained

### The Payload
The attack happens entirely in the **request body**, specifically in a `POST` request. You don't need a login form or input field on the page!

Here is the malicious JSON sent in `confirm_rce.js`:

```javascript
{
  "then": "$1:__proto__:then",  // <--- 1. POLLUTE the 'then' property
  "status": "resolved_model",
  "reason": -1,
  "value": "{\"then\":\"$B1337\"}",
  "_response": {
    "_prefix": "var res=process.mainModule.require('child_process').execSync('whoami').toString().trim(); ...", // <--- 2. INJECT malicious code
    "_chunks": "$Q2",
    "_formData": { "get": "$1:constructor:constructor" } // <--- 3. TRIGGER execution via Function constructor
  }
}
```

- **`$1:__proto__:then`**: Tells the server to modify the `then` property of an object prototype.
- **`$1:constructor:constructor`**: Accesses the global `Function` constructor in JavaScript, which allows creating new functions from strings.
- **`eval` / `execSync`**: The malicious code inside `_prefix` is essentially "compiled" into a function and run by the server.

### The Vulnerable Code
There is no specific "bad line" in *your* application code (like `app/page.js`). The vulnerability is inside the **Next.js framework code** (inside `node_modules`).

This is why it's so dangerous: **Any application simply using these versions of Next.js is vulnerable by default.**

## 4. How to Fix It

The only proper fix is to upgrade your dependencies.

**Vulnerable:**
```json
"dependencies": {
  "next": "15.0.0",
  "react": "19.0.0-..."
}
```

**Safe:**
Update to Next.js 15.0.5 or later.
```bash
npm install next@latest react@latest react-dom@latest
```

## 5. Summary

- **Attack Vector:** HTTP POST request to the server.
- **Root Cause:** Insecure deserialization (unpackaging) of data allowing prototype pollution.
- **Impact:** Full control over the server (Remote Code Execution).
- **Prevention:** Always keep frameworks like Next.js updated.
